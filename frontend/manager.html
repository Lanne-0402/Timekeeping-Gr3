<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Quản lý | Chấm công</title>

  <link rel="stylesheet" href="manager.css"/>
<!-- Google Maps JS -->
  <script
    async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYw975FBYyM0AcZMTe33A1xH8Aw9Y-wz8&libraries=places">
  </script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script defer src="manager.js"></script>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">Timekeeping Admin</div>
    <nav class="nav">
      <button class="nav-item active" data-route="employees">Quản lý nhân viên</button>
      <button class="nav-item" data-route="shifts">Quản lý ca làm</button>
      <button class="nav-item" data-route="reports">Thống kê &amp; báo cáo</button>
      <button class="nav-item" data-route="location">Cài đặt vị trí</button>
    </nav>

    <div class="profile-mini">
      <div>
        <div class="name">Manager</div>
      </div>
    </div>

    <button id="mgrLogout" class="nav-item" style="margin-top:12px;">Đăng xuất</button>
  </aside>

  <!-- Activity -->
  <aside class="activity">
    <h3>Tổng quan</h3>
    <section class="panel">
      <h4>Hôm nay</h4>
      <ul class="stats">
        <li><span id="mgrTotalEmployees">0</span> nhân viên</li>
        <li><span id="mgrTotalAssignments">0</span> lượt tạo ca</li>
      </ul>
    </section>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <section class="content">

            <!-- ========== QUẢN LÝ NHÂN VIÊN ========== -->
      <section id="employees" class="route">
        <div class="card">
          <div class="toolbar">
            <h2>Quản lý nhân viên</h2>
            <div class="filters">
              <input id="empSearch" type="text" placeholder="Tìm theo tên hoặc email">
              <button id="btnReloadEmployees" class="icon-refresh">
                <i class="fa-solid fa-rotate-right"></i>
              </button>
            </div>
          </div>

          <div class="table-wrap">
            <table class="table" id="empTable">
              <thead>
                <tr>
                  <th>Mã NV</th>
                  <th>Họ tên</th>
                  <th>Email</th>
                  <th>Bộ phận</th>
                  <th>Trạng thái</th>
                </tr>
              </thead>
              <tbody>
                <!-- JS sẽ fill -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ========== QUẢN LÝ CA LÀM (simple list) ========== -->
      <section id="shifts" class="route hidden">
        <div class="card">
          <div class="toolbar">
            <h2>Quản lý ca làm</h2>
            <div class="filters">
              <input id="shiftDate" placeholder="Chọn ngày…" class="date-input">

              <input id="shiftStart" type="time">
              <input id="shiftEnd" type="time">

              <button id="btnCreateShift" class="pill-btn">Tạo ca</button>
              

            </div>
          </div>

          <div class="table-wrap">
            <table class="table" id="shiftTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tên ca</th>
                  <th>Giờ bắt đầu</th>
                  <th>Giờ kết thúc</th>
                </tr>
              </thead>
              <tbody>
                <!-- JS fill -->
              </tbody>
            </table>

          </div>
        </div>
                <!-- MODAL GÁN CA -->
        <div id="assignModal" class="modal hidden">
          <div class="modal-content assign-modal">
            <h3>Gán ca cho nhân viên</h3>

            <div class="assign-grid">

              <div class="assign-field">
                <label>Nhân viên</label>
                <select id="assignUser" multiple class="assign-select">
                </select>
              </div>

              <div class="assign-field">
                <label>Ca làm</label>
                <select id="assignShiftSelect" multiple class="assign-select">
                </select>
              </div>

            </div>

            <div class="assign-bottom">
              <div class="assign-date">
                <label>Ngày</label>
                <input id="assignDate" type="date">
              </div>

              <div class="assign-actions">
                <button id="btnAssignConfirm" class="pill-btn blue">Gán ca</button>
                <button id="btnAssignClose" class="pill-btn red">Đóng</button>
              </div>
            </div>

          </div>
        </div>

      </section>

      <!-- ========== THỐNG KÊ & BÁO CÁO ========== -->
      <section id="reports" class="route hidden">
        <div class="card">
          <div class="toolbar">
            <h2>Thống kê & Báo cáo</h2>

            <div class="filters">
              <label for="repMonth">Chọn tháng:</label>
              <input id="repMonth" type="month" value="2025-11">
              <button id="btnReloadReports" class="icon-refresh">
                  <i class="fa-solid fa-rotate-right"></i>
              </button>
              <button id="btnLoadSummary" class="pill-btn">Xuất báo cáo</button>
            </div>
          </div>

         <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-top: 20px;">

            <div class="stat-card clickable" id="gotoShiftTab">
              <h3>Tổng ca</h3>
              <p id="sumTotal">0</p>
            </div>

            <div class="stat-card clickable" id="gotoPresentList">
              <h3>Có mặt</h3>
              <p id="sumPresent">0</p>
            </div>

            <div class="stat-card clickable" id="gotoAbsentList">
              <h3>Vắng</h3>
              <p id="sumAbsent">0</p>
            </div>

            <div class="stat-card clickable" id="gotoRate">
              <h3>Tỉ lệ đi làm</h3>
              <p id="sumRate">0%</p>
            </div>
          </div>
        </div>

        <!-- Chi tiết theo nhân viên / ca làm -->
        <div class="card" style="margin-top:20px;">
          <div class="toolbar">
            <h3>Chi tiết</h3>
            <div class="filters">
              <input id="employeeSearchBox" type="text" placeholder="Tìm nhân viên..." class="search-box"/>
            </div>
          </div>

          <div id="employeeSummaryTable" class="table-wrap" style="margin-bottom:20px;">
            <!-- Bảng tổng quan theo nhân viên -->
          </div>
        </div>
      </section>

      <!-- ========== DUYỆT YÊU CẦU ========== -->
      <section id="requests" class="route hidden">
        <div class="card">
          <div class="toolbar">
            <h2>Duyệt yêu cầu</h2>
            <div class="filters">
              <select id="reqFilter">
                <option value="all">Tất cả</option>
                <option value="pending">Đang chờ</option>
                <option value="approved">Đã duyệt</option>
                <option value="rejected">Đã từ chối</option>
              </select>
            </div>
          </div>

          <div class="table-wrap">
            <table id="reqTable">
              <thead>
                <tr>
                  <th>Nhân viên</th>
                  <th>Ngày / Ca</th>
                  <th>Loại</th>
                  <th>Nội dung</th>
                  <th>Trạng thái</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody>
                <!-- JS fill -->
              </tbody>
            </table>
          </div>
        </div>
      </section>


      <!-- ================= CÀI ĐẶT VỊ TRÍ (MAP FREE) ================= -->
      <section id="location" class="route hidden">
        <div class="card">
          <div class="toolbar">
            <h2>Cài đặt vị trí công ty</h2>
          </div>

          <p style="color:var(--muted); margin-bottom:12px">
            Chọn vị trí công ty để kiểm tra chấm công theo bán kính cho phép.
          </p>

          <!-- Leaflet Map -->
          <div id="map" style="
              width:100%;
              height:450px;
              border-radius:10px;
              margin-bottom:12px;
          "></div>

          <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input id="company-lat" type="number" step="0.000001" placeholder="Lat" style="flex:1;">
            <input id="company-lng" type="number" step="0.000001" placeholder="Lng" style="flex:1;">
            <input id="company-radius" type="number" placeholder="Bán kính (m)" value="200" style="width:150px;">
          </div>

          <button id="btnSaveLocation" class="pill-btn">Lưu vị trí</button>
          <button id="btnGPS" class="btn outline" style="margin-left:10px;">Lấy GPS hiện tại</button>
        </div>
      </section>

    </section>
    
  </main>
  <!-- EDIT EMPLOYEE MODAL -->
  <div id="editEmpModal" class="modal hidden">
    <div class="modal-content">
      <h2>Sửa thông tin nhân viên</h2>

      <label>Họ tên</label>
      <input id="editEmpName" type="text" />

      <label>Email</label>
      <input id="editEmpEmail" type="text" />

      <label>Bộ phận</label>
      <input id="editEmpDept" type="text" />

      <label>Trạng thái tài khoản</label>
      <select id="editEmpStatus">
        <option value="active">Đang hoạt động</option>
        <option value="inactive">Đã khoá</option>
      </select>

      <div class="modal-actions">
        <button id="btnDeleteEmp" class="pill-btn outline">Xóa tài khoản</button>

        <div style="display:flex; gap:10px;">
          <button id="btnSaveEmp" class="pill-btn outline">Lưu</button>
          <button id="btnCloseEditEmp" class="pill-btn outline">Đóng</button>
        </div>
      </div>
    </div>
  </div>
  <div id="empDetailModal" class="modal hidden">
    <div class="modal-content" style="width:800px; max-height:90vh; overflow:auto;">
      <h2 id="detailEmpName">Chi tiết nhân viên</h2>

      <div id="empDetailTableWrap" class="table-wrap" style="margin-top:16px;">
        <!-- JS fill -->
      </div>

      <div style="text-align:right; margin-top:16px;">
        <button id="btnCloseEmpDetail" class="pill-btn outline">Đóng</button>
      </div>
    </div>
  </div>
  <div id="presentModal" class="modal hidden">
    <div class="modal-content" style="width:450px;">
      <h3>Danh sách nhân viên đi làm</h3>
      <ul id="presentList"></ul>
      <div class="modal-footer">
        <button id="closePresent" class="pill-btn outline">Đóng</button>
      </div>
    </div>
  </div>
  <div id="absentModal" class="modal hidden">
  <div class="modal-content" style="width:450px;">
      <h3>Danh sách nhân viên vắng</h3>
      <ul id="absentList"></ul>
      <div class="modal-footer">
        <button id="closeAbsent" class="pill-btn outline">Đóng</button>
      </div>
    </div>
  </div>
  <div id="rateModal" class="modal hidden">
  <div class="modal-content" style="width:450px;">
      <h3>Phân tích tỉ lệ đi làm</h3>
      <ul id="rateList"></ul>
      <div class="modal-footer">
        <button id="closeRate" class="pill-btn outline">Đóng</button>
      </div>
    </div>
  </div>
<!-- ==============================
      MODAL CHỈNH SỬA CA LÀM
     ============================== -->
<div id="editShiftModal" class="modal hidden">
  <div class="modal-content shift-editor">

    <h2>Chỉnh sửa ca làm</h2>

    <div class="form-group">
      <label>Ngày làm</label>
      <input type="date" id="editShiftDate" class="input">
    </div>

    <div class="form-row">
      <div class="form-group half">
        <label>Giờ bắt đầu</label>
        <input type="time" id="editShiftStart" class="input">
      </div>
      <div class="form-group half">
        <label>Giờ kết thúc</label>
        <input type="time" id="editShiftEnd" class="input">
      </div>
    </div>

    <div class="section">
      <h3>Nhân viên trong ca</h3>
      <div id="editShiftEmployees" class="employee-list"></div>
    </div>

    <div class="section">
      <h3>Thêm nhân viên</h3>
      <div class="form-row">
        <select id="editShiftAddEmployee" class="input"></select>
        <button class="btn small" onclick="confirmAddEmployee()">+ Thêm</button>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn primary" onclick="saveShiftChanges()">Lưu thay đổi</button>
      <button class="btn outline" onclick="closeEditShiftModal()">Đóng</button>
    </div>

  </div>
</div>


</body>
</html>
